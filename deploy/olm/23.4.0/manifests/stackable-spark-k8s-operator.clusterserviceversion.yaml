---
apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  name: superset-operator.v23.4.0
spec:
  annotations:
    support: stackable.tech
    olm.properties: '[]'
    categories: Storage
    capabilities: Full Lifecycle
    description: Stackable Operator for Apache Superset
    repository: https://github.com/stackabletech/superset-operator
    containerImage: docker.stackable.tech/stackable/superset-operator:23.4.0

  displayName: Stackable Operator for Apache Superset
  description: |-
    This is a Kubernetes operator to manage [Apache Superset](https://superset.apache.org/) ensembles. The Stackable Apache Superset Operator
    is part of the Stackable Data Platform, a curated selection of the best open source data apps like Kafka, Druid, Trino or Spark, all
    working together seamlessly. Based on Kubernetes, it runs everywhere â€“ on prem or in the cloud.

    You can install the operator using [stackablectl or helm](https://docs.stackable.tech/superset/stable/getting_started/installation.html).
    See it in action in one of our [demos](https://stackable.tech/en/demos/) or follow this
    [tutorial](https://docs.stackable.tech/superset/stable/getting_started/first_steps.html).

    N.B. this operator requires the following Stackable internal operators to be installed as well:

    - [Commons Operator](https://github.com/stackabletech/commons-operator)
    - [Secret Operator](https://github.com/stackabletech/secret-operator)
    - [Druid Operator](https://github.com/stackabletech/druid-operator)
  keywords:
    - superset
  maintainers:
    - email: info@stackable.tech
      name: Stackable GmbH
  maturity: stable
  provider:
    name: Stackable GmbH
    url: https://stackable.tech
  version: 23.4.0
  minKubeVersion: 1.23.0

  installModes:
    - supported: true
      type: OwnNamespace
    - supported: true
      type: SingleNamespace
    - supported: false
      type: MultiNamespace
    - supported: false
      type: AllNamespaces

  customresourcedefinitions:
    owned:
      # a list of CRDs that this operator owns
      # name is the metadata.name of the CRD (which is of the form <plural>.<group>)
      - name: supersetclusters.superset.stackable.tech
        # version is the spec.versions[].name value defined in the CRD
        version: v1alpha1
        # kind is the CamelCased singular value defined in spec.names.kind of the CRD.
        kind: SupersetCluster
        # human-friendly display name of the CRD for rendering in graphical consoles (optional)
        displayName: Apache Superset Cluster
        # a short description of the CRDs purpose for rendering in graphical consoles (optional)
        description: Represents a Superset Cluster
      - name: supersetdbs.superset.stackable.tech
        version: v1alpha1
        kind: SupersetDB
        displayName: Apache Superset Database
        description: Represents a Superset Database
      - name: druidconnections.superset.stackable.tech
        version: v1alpha1
        kind: DruidConnection
        displayName: Apache Superset/Apache Druid connection
        description: Represents a connection from Superset to a Druid instance

  relatedImages:
    - name: superset-operator
      image: docker.stackable.tech/stackable/superset-operator:23.4.0
  install:
    # strategy indicates what type of deployment artifacts are used
    strategy: deployment
    # spec for the deployment strategy is a list of deployment specs and required permissions - similar to a pod template used in a deployment
    spec:
      permissions:
        - serviceAccountName: superset-operator
          rules:
            - apiGroups:
                - ""
              resources:
                - pods
              verbs:
                - '*'
      # permissions required at the cluster scope
      clusterPermissions:
        - serviceAccountName: superset-operator
          rules:
            - apiGroups:
                - ""
              resources:
                - nodes
              verbs:
                - list
                - watch
            - apiGroups:
                - ""
              resources:
                - pods
                - configmaps
                - secrets
                - services
                - endpoints
                - serviceaccounts
                - secrets
              verbs:
                - create
                - delete
                - get
                - list
                - patch
                - update
                - watch
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - rolebindings
              verbs:
                - create
                - delete
                - get
                - list
                - patch
                - update
                - watch
            - apiGroups:
                - apps
              resources:
                - statefulsets
              verbs:
                - get
                - create
                - delete
                - list
                - patch
                - update
                - watch
            - apiGroups:
                - batch
              resources:
                - jobs
              verbs:
                - create
                - get
                - list
                - patch
                - update
                - watch
            - apiGroups:
                - apiextensions.k8s.io
              resources:
                - customresourcedefinitions
              verbs:
                - get
            - apiGroups:
                - events.k8s.io
              resources:
                - events
              verbs:
                - create
            - apiGroups:
                - superset.stackable.tech
              resources:
                - supersetclusters
                - druidconnections
                - druidconnections/status
                - supersetdbs
                - supersetdbs/status
              verbs:
                - get
                - list
                - patch
                - watch
            - apiGroups:
                - superset.stackable.tech
              resources:
                - supersetclusters/status
              verbs:
                - patch
            - apiGroups:
                - superset.stackable.tech
              resources:
                - supersetdbs
              verbs:
                - create
            - apiGroups:
                - authentication.stackable.tech
              resources:
                - authenticationclasses
              verbs:
                - get
                - list
                - watch
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - clusterroles
              verbs:
                - bind
              resourceNames:
                - superset-clusterrole
            - apiGroups:
                - security.openshift.io
              resources:
                - securitycontextconstraints
              resourceNames:
                - hostmount-anyuid
              verbs:
                - use

      deployments:
        - name: superset-operator
          spec:
            replicas: 1
            strategy:
              type: Recreate
            selector:
              matchLabels:
                app.kubernetes.io/name: superset-operator
                app.kubernetes.io/instance: superset-operator
            template:
              metadata:
                labels:
                  app.kubernetes.io/name: superset-operator
                  app.kubernetes.io/instance: superset-operator
              spec:
                serviceAccountName: superset-operator
                securityContext: {}
                containers:
                  - name: superset-operator
                    securityContext: {}
                    image: docker.stackable.tech/stackable/superset-operator:23.4.0
                    imagePullPolicy: IfNotPresent
                    resources: {}
                    volumeMounts:
                      - mountPath: /etc/stackable/superset-operator/config-spec
                        name: config-spec
                volumes:
                  - name: config-spec
                    configMap:
                      name: superset-operator-configmap
